# Анализ состояния подшипника с использованием машинного обучения

Этот проект представляет собой систему для определения состояния подшипника на основе анализа FFT (быстрого преобразования Фурье) звуковых сигналов с использованием нейронных сетей.

## 🎯 Цель проекта

Создать модель машинного обучения, которая может:
- Определять состояние подшипника в процентах (0-100%)
- Показывать процент износа подшипника
- Использовать MPS (Metal Performance Shaders) для ускорения обучения
- Обрабатывать данные FFT с timestamp и частотами
- Сохранять и загружать обученные модели для повторного использования

## 📁 Структура проекта

```
bearing-signal/
├── main.py              # Основной файл запуска
├── models.py            # Модели нейронных сетей
├── dataset.py           # Загрузка и обработка данных
├── training.py          # Функции обучения и оценки
├── prediction.py        # Функции предсказания
├── visualization.py     # Визуализация результатов
├── utils.py            # Утилиты и настройки
├── predict_with_saved_model.py  # Скрипт для предсказаний с сохраненной моделью
├── requirements.txt     # Зависимости
├── .gitignore          # Исключения для Git
├── README.md           # Документация
├── bearing_analysis_results.png  # Результаты визуализации
├── saved_models/       # Папка с сохраненными моделями
│   ├── bearing_classifier.pth    # Сохраненная модель
│   ├── scaler.pkl               # Сохраненный scaler
│   ├── pca.pkl                  # Сохраненный PCA
│   └── model_metadata.pkl       # Метаданные модели
├── bad_bearing(0).csv      # Данные плохого подшипника
├── normal_bearing(0.5).csv # Данные нормального подшипника
├── new_bearing(1).csv      # Данные нового подшипника
└── test_bearing.csv        # Тестовые данные
```

## 🚀 Установка и запуск

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Обучение и сохранение модели
```bash
python main.py
```

### 3. Использование сохраненной модели для предсказаний
```bash
python predict_with_saved_model.py
```

## 💾 Сохранение и загрузка моделей

### Автоматическое сохранение
При запуске `main.py` модель автоматически сохраняется в папку `saved_models/`:
- `bearing_classifier.pth` - веса модели PyTorch
- `scaler.pkl` - нормализатор данных
- `pca.pkl` - компоненты PCA
- `model_metadata.pkl` - метаданные модели

### Загрузка модели для предсказаний
```python
from utils import load_saved_model

# Загрузка сохраненной модели
model, scaler, pca, metadata = load_saved_model("saved_models")

# Использование для предсказаний
if model is not None:
    # Ваш код для предсказаний
    pass
```

### Использование сохраненной модели
```python
from predict_with_saved_model import predict_with_saved_model

# Анализ нового файла данных
predict_with_saved_model("path/to/your/data.csv")
```

## 🎨 Визуализация модели

### Автоматическая визуализация
При запуске `main.py` автоматически создается визуализация обученной модели в папке `visualizations/`:
- `trained_model_architecture.png` - графическая визуализация архитектуры

### Ручная визуализация
```bash
python model_visualization.py
```

Создает следующие файлы:
- `model_architecture.png` - визуализация базовой архитектуры
- `saved_model_architecture.png` - визуализация сохраненной модели
- `model_diagram.txt` - текстовая диаграмма архитектуры

### Архитектура модели
```
Входной слой (100 признаков после PCA)
    ↓
┌─────────────────────────────────────┐
│ Linear(100 → 256)                  │
│ ReLU                               │
│ BatchNorm1d(256)                   │
│ Dropout(0.3)                       │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ Linear(256 → 128)                  │
│ ReLU                               │
│ BatchNorm1d(128)                   │
│ Dropout(0.3)                       │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ Linear(128 → 64)                   │
│ ReLU                               │
│ BatchNorm1d(64)                    │
│ Dropout(0.2)                       │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ Linear(64 → 32)                    │
│ ReLU                               │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ Linear(32 → 1)                     │
│ Sigmoid                            │
└─────────────────────────────────────┘
    ↓
Выход (0-1, масштабируется до 0-100%)
```

### Статистика модели
- **Всего параметров**: 70,017
- **Обучаемых параметров**: 70,017
- **Слоев**: 17 (включая активации и нормализацию)
- **Входной размер**: 100 признаков (после PCA)
- **Выход**: 1 значение (0-100%)

## 📊 Описание данных

### Формат CSV файлов:
- **Первый столбец**: timestamp (время)
- **Первая строка**: частоты (Hz)
- **Остальные данные**: значения FFT для каждой частоты

### Метки состояний:
- **0%** - Плохой подшипник (требует замены)
- **50%** - Нормальный подшипник (средний износ)
- **100%** - Новый подшипник (отличное состояние)

## 🧠 Архитектура модели

### Нейронная сеть:
- **Входной слой**: 100 признаков (после PCA)
- **Скрытые слои**: 256 → 128 → 64 → 32 нейронов
- **Активации**: ReLU + BatchNorm + Dropout
- **Выход**: 1 нейрон с Sigmoid (масштабируется до 0-100%)

### Предобработка данных:
1. Удаление timestamp и строки с частотами
2. Обработка NaN значений
3. Замена запятых на точки в десятичных числах
4. Нормализация (StandardScaler)
5. Уменьшение размерности (PCA до 100 компонент)

## ⚡ Ускорение обучения

Модель автоматически использует:
- **MPS** (Metal Performance Shaders) на Apple Silicon
- **CUDA** на NVIDIA GPU
- **CPU** как fallback

## 📈 Результаты

### Метрики модели:
- **Точность**: 97.58%
- **Precision/Recall**: 0.98/0.98 (среднее)
- **Объясненная дисперсия PCA**: 60.18%

### Пример вывода:
```
Результат предсказания для test_bearing.csv:
Среднее предсказание: 16.55%
Состояние подшипника: Плохой (0.0%)
Процент износа подшипника: 83.45%
```

## 📋 Модули

### `models.py`
- `BearingClassifier`: Нейронная сеть для классификации

### `dataset.py`
- `BearingDataset`: PyTorch датасет
- `load_and_preprocess_data()`: Загрузка и обработка данных
- `prepare_data_loaders()`: Подготовка DataLoader

### `training.py`
- `get_device()`: Определение устройства (MPS/CUDA/CPU)
- `train_model()`: Обучение модели
- `evaluate_model()`: Оценка модели

### `prediction.py`
- `predict_test_bearing()`: Предсказание для новых данных

### `visualization.py`
- `visualize_results()`: Создание графиков и диаграмм

### `utils.py`
- `set_seeds()`: Установка seed для воспроизводимости
- `print_summary()`: Вывод итогового резюме
- `print_model_summary()`: Подробный самари по модели
- `load_saved_model()`: Загрузка сохраненной модели и препроцессоров

## 🔧 Настройки

### Основные параметры:
- **Эпохи обучения**: 100
- **Размер батча**: 32
- **Learning rate**: 0.001
- **PCA компоненты**: 100
- **Размер тестовой выборки**: 20%

### Пороги классификации:
- **< 25%**: Плохой подшипник
- **25-75%**: Нормальный подшипник
- **> 75%**: Новый подшипник

## 📊 Визуализация

Модель создает файл `bearing_analysis_results.png` с:
1. Графиком потерь (обучающая и тестовая)
2. Графиком точности
3. Матрицей ошибок
4. Распределением предсказаний

## 🤝 Использование

### Для анализа новых данных:
1. Поместите CSV файл с данными в папку проекта
2. Обновите путь в `prediction.py`
3. Запустите `python main.py`

### Для изменения модели:
1. Отредактируйте архитектуру в `models.py`
2. Настройте гиперпараметры в `training.py`
3. Перезапустите обучение

## 📝 Лицензия

Этот проект предназначен для образовательных и исследовательских целей. 